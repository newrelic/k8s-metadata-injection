suite: test affinity setup
templates:
  - templates/deployment.yaml
release:
  name: release
  namespace: ns
tests:
  - it: affinity is not set by default
    set:
      cluster: my-cluster
      asserts:
        - isNull:
            path: spec.template.spec.affinity
  - it: affinity custom value
    set:
      cluster: my-cluster
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/os
                operator: In
                values:
                - linux
      asserts:
        - equal:
            path: spec.template.spec.affinity
            value:
              nodeAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                  nodeSelectorTerms:
                  - matchExpressions:
                    - key: kubernetes.io/os
                      operator: In
                      values:
                      - linux
